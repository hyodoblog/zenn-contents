---
title: "ã€LINE APIã€‘é…ä¿¡åˆ†æAPIã®ä½¿ç”¨æ–¹æ³•ã‚’ãƒ¡ãƒ¢"
emoji: "ğŸŸï¸"
type: "tech"
topics:
  - "line"
published: true
published_at: "2022-11-24 07:58"
---

ä»Šå›ã¯ã€ã“ã¡ã‚‰ã®ãƒ„ã‚¤ãƒ¼ãƒˆã§ç´¹ä»‹ã—ãŸAPIã®ä½¿ç”¨æ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚

@[tweet](https://twitter.com/hyodoblog/status/1595008622601420803)

ä¸€æ–‰é…ä¿¡ã®åˆ†æAPI
https://developers.line.biz/ja/reference/messaging-api/#get-message-event

ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé…ä¿¡ã®åˆ†æAPI
https://developers.line.biz/ja/reference/messaging-api/#get-statistics-per-unit

# ä½¿ç”¨æ–¹æ³•

API
```typescript
export const getLineInsight = async (unitId: string, from: string, to: string): Promise<LineInsight | null> => {
  const url = 'https://api.line.me/v2/bot/insight/message/event/aggregation'
  const params = {
    customAggregationUnit: unitId,
    from,
    to
  }
  const headers = {
    Authorization: `Bearer ${LINE_MESSAGING_CHANNEL_ACCESS_TOKEN}`
  }

  try {
    const { data } = await axios.get(url, {
      params,
      headers
    })
    return data
  } catch (err) {
    console.error(err)
    return null
  }
}
```

å‹
```typescript
interface LineInsight {
  overview: {
    uniqueImpression: number | null
    uniqueClick: number | null
    uniqueMediaPlayed: number | null
    uniqueMediaPlayed100Percent: number | null
  }
  messages: [
    {
      seq: number
      impression: number | null
      mediaPlayed: number | null
      mediaPlayed25Percent: number | null
      mediaPlayed50Percent: number | null
      mediaPlayed75Percent: number | null
      mediaPlayed100Percent: number | null
      uniqueMediaPlayed: number | null
      uniqueMediaPlayed25Percent: number | null
      uniqueMediaPlayed50Percent: number | null
      uniqueMediaPlayed75Percent: number | null
      uniqueMediaPlayed100Percent: number | null
    }
  ]
  clicks: {
    seq: number
    url: string
    click: number
    uniqueClick: number | null
    uniqueClickOfRequest: number | null
  }[]
}
```

`unitId`ã¨ã„ã†ã®ãŒLINEãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚‚èª¬æ˜ãŒã‚ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—IDï¼ˆãƒ¦ãƒ‹ãƒƒãƒˆåï¼‰ã®ã“ã¨ã§ã™ã€‚
https://developers.line.biz/ja/docs/messaging-api/unit-based-statistics-aggregation/#assign-names-to-units-when-sending-messages

ã“ã®IDã‚’ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé…ä¿¡ã”ã¨ã«æŒ¯ã‚Šåˆ†ã‘ã‚‹ã“ã¨ã§å„ã€…ã®åˆ†æãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
