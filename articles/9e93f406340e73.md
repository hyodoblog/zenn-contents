---
title: "LINE Botã§ç”»åƒã‚’å–ã‚Šæ‰±ã†æ–¹æ³•"
emoji: "ğŸŒ"
type: "tech"
topics:
  - "line"
  - "linebot"
  - "buffer"
  - "typescript"
  - "streamapi"
published: true
published_at: "2022-04-14 16:37"
---

# LINE Botã§ã®ç”»åƒã®å–ã‚Šæ‰±ã„æ–¹æ³•

LINE Botã§ç”»åƒã‚’æ‰±ã†æ–¹æ³•ã¯ä»¥ä¸‹ã®2ç¨®é¡ã‚ã‚Šã¾ã™ã€‚

- Stream API
- Buffer

ä»Šå›ã¯LINE Botã§ã®ã“ã®2ã¤ã®å–ã‚Šæ‰±ã„æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚


## å‰ææ¡ä»¶

- messageIdï¼šwebhookã§å–å¾—ã—ãŸ`event.message.id`
- lineï¼š`@line/bot-sdk`ã§åˆæœŸåŒ–ã—ãŸClient

## Stream API

```ts
export const getMessageContent = (messageId: string): Promise<Readable> => {
  return line.getMessageContent(messageId)
}
```

è¿”ã‚Šå€¤ã¯Readableã¨ã—ã¦æ‰±ã†ã“ã¨ãŒã§ãã¾ã™ã€‚


## Buffer

```ts
export const getMessageContent = (messageId: string): Promise<Buffer> => {
  return new Promise((resolve, reject) =>
    line
      .getMessageContent(messageId)
      .then((stream) => {
        const content: Buffer[] = []
        stream.on('data', (chunk) => content.push(Buffer.from(chunk)))
        stream.on('end', () => resolve(Buffer.concat(content)))
        stream.on('error', (err) => {
          logger.error(err)
          reject('lineGetContent')
        })
      })
      .catch((err) => {
        logger.error(err)
        reject('lineGetContent')
      })
  )
}
```

## é•ã„

LINEã«é€ã£ãŸç”»åƒã‚’ãã®ã¾ã¾ä»–ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å ´åˆã¯ã€Stream APIã§æ‰±ã†ã»ã†ãŒãƒ¡ãƒ¢ãƒªã‚’æµªè²»ã›ãšã«æ¸ˆã¿ã¾ã™ã€‚
Bufferã‚’æ‰±ã†ã®ã¯ã€Canvasã‚„å¤–éƒ¨APIã‚’ä½¿ã£ã¦ç”»åƒã‚’åŠ å·¥ã¾ãŸã¯è§£æã™ã‚‹éš›ã«ã‚ˆãä½¿ã‚ã‚Œã¾ã™ã€‚
